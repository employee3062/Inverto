name: Test AWS Configure
on:
  workflow_dispatch:
permissions:
  id-token: write   # Required for OIDC
  contents: read
jobs:
  test-aws-configure:
    runs-on: ubuntu-latest
    steps:
      - name: Set AWS_ROLE_TO_ASSUME env
        run: echo "AWS_ROLE_TO_ASSUME=${{ secrets.AWS_ROLE_TO_ASSUME }}" >> $GITHUB_ENV

      - name: Debug AWS_ROLE_TO_ASSUME
        run: echo "AWS_ROLE_TO_ASSUME='${AWS_ROLE_TO_ASSUME}'"
        
      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v5
        with:
          aws-region: ca-central-1
          role-to-assume: ${{ env.AWS_ROLE_TO_ASSUME }}
          role-session-name: GitHubActions

  example:
    runs-on: ubuntu-latest
    steps:
      - name: Set AWS_ROLE_TO_ASSUME env
        run: echo "AWS_ROLE_TO_ASSUME=${{ secrets.AWS_ROLE_TO_ASSUME }}" >> $GITHUB_ENV

      - name: Conditional step based on secret
        if: env.AWS_ROLE_TO_ASSUME == 'arn:aws:iam::659271373941:role/inverto-stack-GithubOidcRole-jlfHeYH1OlEs'
        run: echo "Secret matches the expected value"
